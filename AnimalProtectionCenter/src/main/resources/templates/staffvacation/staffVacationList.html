<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
  xmlns:layout="http://www.ultraq.net.nz/web/thymeleaf/layout"
  layout:decorator="@{layout/default2}">
<th:block layout:fragment="customCss">
	<!-- JQuery DataTable Css -->
    <link href="/plugins/jquery-datatable/skin/bootstrap/css/dataTables.bootstrap.css" rel="stylesheet">
    <!-- Bootstrap Select Css -->
    <link href="/plugins/bootstrap-select/css/bootstrap-select.css" rel="stylesheet" />
    <style>
    .bootstrap-select:not([class*="col-"]):not([class*="form-control"]):not(.input-group-btn){
    	width:auto;
    }
    .btn:not(.btn-link):not(.btn-circle) span {
    	margin-left: 15px;
    }
    </style>
</th:block>

<th:block layout:fragment="customTitle">
	<title>직원 휴가, 외출 목록</title>
</th:block> 
<th:block layout:fragment="customHeadScript">
</th:block> 
<th:block layout:fragment="customContents">
	<section class="content">
		<div class="col-lg-12">
			<div class="card">
				<div class="header">
					<h2>직원 휴가, 외출 신청 목록</h2>
				</div>
	            <div class="body">
	            	<table id="dataTabelEaxm1" class="table table-bordered table-striped table-hover">
	                    <thead>
	                        <tr>
		                         <th data-orderable="false"></th>
		                         <th><div class="align-center">직원 코드</div></th>
		                         <th><div class="align-center">소속</div></th>
		                         <th><div class="align-center">직급</div></th>
		                         <th><div class="align-center">이름</div></th>
		                         <th><div class="align-center">종류</div></th>
	                         	 <th><div class="align-center">사유</div></th>
	                         	 <th><div class="align-center">시작일</div></th>
	                         	 <th><div class="align-center">종료일</div></th>
	                         	 <th><div class="align-center">기간 산출</div></th>
	                         	 <th><div class="align-center">승인 상태</div></th>
	                         	 <th><div class="align-center">등록 날짜</div></th>
	                         	 <th><div class="align-center">삭제</div></th>
		                	</tr>
	                    </thead>
	                    <tbody>
	                    	<tr th:each="v,i : ${vacation}" class="odd">
	                   			<td><div class="align-center">[[${i.size-i.index}]]</div></td>
	                   			<td><div class="align-center">[[${v.staff.staffCode}]]</div></td>
		                        <td><div class="align-center">[[${v.staff.staffPart}]]</div></td>
		                        <td><div class="align-center">[[${v.staff.staffRank}]]</div></td>
		                        <td><div class="align-center">[[${v.staff.staffName}]]</div></td>
		                        <td><div class="align-center">[[${v.vacationType}]]</div></td>
		                        <td><div class="align-center">[[${v.vacationReason}]]</div></td>
		                        <td><div class="align-center">[[${v.vacationStartDate}]]</div></td>
		                        <td><div class="align-center">[[${v.vacationEndDate}]]</div></td>
		                        <td><div class="align-center">[[${v.vacationTerm}]](일)</div></td>
		                        <td>
		                        	<div class="align-center">
		                        		<select id="vSelect" th:data-code="${v.vacationCode}">
		                        			<option value="보류">보류</option>
		                        			<option value="승인">승인</option>
		                        			<option value="취소">취소</option>
		                        			<option value="거절">거절</option>
		                        		</select>
		                        	</div>
		                        </td>
		                        <td><div class="align-center">[[${v.vacationRegDate}]]</div></td>
		                        <td>
		                            <div class="align-center">
		                            	<a class="delete" th:data-myurl="'/staff/staffvacationdelete?send_code='+${v.vacationCode}" href="javascript:void(0)">
					            			<i class="material-icons">delete</i>
					            		</a>
			                       	</div>
		                       	</td>
	                    	</tr>
	                    </tbody>
	                </table>
	            </div>
	            <div class="header">
					<h2>직원 휴가, 외출 목록</h2>
				</div>
	            <div class="body">
	            	<table id="dataTabelEaxm2" class="table table-bordered table-striped table-hover">
	                    <thead>
	                        <tr>
		                         <th data-orderable="false"></th>
		                         <th><div class="align-center">직원 코드</div></th>
		                         <th><div class="align-center">소속</div></th>
		                         <th><div class="align-center">직급</div></th>
		                         <th><div class="align-center">이름</div></th>
		                         <th><div class="align-center">종류</div></th>
	                         	 <th><div class="align-center">사유</div></th>
	                         	 <th><div class="align-center">시작일</div></th>
	                         	 <th><div class="align-center">종료일</div></th>
	                         	 <th><div class="align-center">기간 산출</div></th>
	                         	 <th><div class="align-center">승인 상태</div></th>
	                         	 <th><div class="align-center">등록 날짜</div></th>
		                	</tr>
	                    </thead>
	                    <tbody>
	                    	<tr th:each="v,i : ${vList}" class="odd">
	                   			<td><div class="align-center">[[${i.size-i.index}]]</div></td>
	                   			<td><div class="align-center">[[${v.staff.staffCode}]]</div></td>
		                        <td><div class="align-center">[[${v.staff.staffPart}]]</div></td>
		                        <td><div class="align-center">[[${v.staff.staffRank}]]</div></td>
		                        <td><div class="align-center">[[${v.staff.staffName}]]</div></td>
		                        <td><div class="align-center">[[${v.vacationType}]]</div></td>
		                        <td><div class="align-center">[[${v.vacationReason}]]</div></td>
		                        <td><div class="align-center">[[${v.vacationStartDate}]]</div></td>
		                        <td><div class="align-center">[[${v.vacationEndDate}]]</div></td>
		                        <td><div class="align-center">[[${v.vacationTerm}]](일)</div></td>
		                        <td>
		                        	<div class="align-center">
		                        		<select id="vSelect" th:data-code="${v.vacationCode}" disabled="disabled">
		                        			<option value="보류" th:selected="${v.vacationAdmissionState} == '보류'">보류</option>
		                        			<option value="승인" th:selected="${v.vacationAdmissionState} == '승인'">승인</option>
		                        			<option value="취소" th:selected="${v.vacationAdmissionState} == '취소'">취소</option>
		                        			<option value="거절" th:selected="${v.vacationAdmissionState} == '거절'">거절</option>
		                        		</select>
		                        	</div>
		                        </td>
		                        <td><div class="align-center">[[${v.vacationRegDate}]]</div></td>
	                    	</tr>
	                    </tbody>
	                </table>
	            </div>
	        </div>
       	</div>
   	</section>
</th:block> 
<th:block layout:fragment="customFooterScript">
	<!-- Jquery DataTable Plugin Js -->
    <script src="/plugins/jquery-datatable/jquery.dataTables.js"></script>
    <script src="/plugins/jquery-datatable/skin/bootstrap/js/dataTables.bootstrap.js"></script>
    <script src="/plugins/jquery-datatable/extensions/export/dataTables.buttons.min.js"></script>
    <script src="/plugins/jquery-datatable/extensions/export/buttons.flash.min.js"></script>
    <script src="/plugins/jquery-datatable/extensions/export/jszip.min.js"></script>
    <script src="/plugins/jquery-datatable/extensions/export/pdfmake.min.js"></script>
    <script src="/plugins/jquery-datatable/extensions/export/vfs_fonts.js"></script>
    <script src="/plugins/jquery-datatable/extensions/export/buttons.html5.min.js"></script>
    <script src="/plugins/jquery-datatable/extensions/export/buttons.print.min.js"></script>
    <script>
    	$(function(){
    		$('#dataTabelEaxm1').dataTable({
    			"aaSorting": []
    		});
    		$('#dataTabelEaxm2').dataTable({
    			"aaSorting": []
    		});
    		
    		$('#vSelect').change(function(){
    			var val = $(this).val();
    			var code = $(this).data('code');
    			
    			
				var request = $.ajax({
					url: "/ajax/vacationAdmission",
					method: "POST",
					data: { code : code ,
							val : val},
					dataType: "json"
				});
				request.done(function( msg ) {
		
				});
				 
				request.fail(function( jqXHR, textStatus ) {
					alert( "Request failed: " + textStatus );
				});
    		});

    		$('.delete').click(function(){
    			swal('삭제하시겠습니까?', {
					title:'경고',
					icon:'error',
					buttons: true,
				})
    			.then((Delete) => {
    				var val = $(this).data('myurl');
    				console.log(val);
    				if(Delete){
    					swal({
    							title: '확인',
    					      	icon: "warning",
    					      	text:"정말로 삭제하시겠습니까?",
    					      	buttons: true,
    					    })
    					    .then((value) => {
    					    	if(value) location.href = val;
    					    });
    				}else{
    					console.log('취소');
    				}
    			});
    		});
    	});
    </script>
</th:block>
</html>